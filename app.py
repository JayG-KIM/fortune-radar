__version__ = "2.0.0"
__release_date__ = "2025-02-23"

import streamlit as st
import datetime
import requests
import random
import os
from dotenv import load_dotenv
from korean_lunar_calendar import KoreanLunarCalendar
import holidays

# --- 1. 환경 변수 및 설정 ---
load_dotenv()
WEATHER_API_KEY = os.getenv("WEATHER_API_KEY")

st.set_page_config(page_title="오늘의 눈치 레이더", page_icon="📡", layout="wide")

# CSS 스타일
st.markdown("""
<style>
    .info-card {
        background-color: #1E1E1E; padding: 10px; border-radius: 8px; text-align: center;
        border: 1px solid #333; margin-bottom: 5px; height: 120px;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
    }
    .big-icon { font-size: 24px; margin-bottom: 5px; }
    .card-title { font-size: 12px; font-weight: 600; color: #A0A0A0; margin-bottom: 2px; text-transform: uppercase; }
    .card-value { font-size: 14px; color: #FFFFFF; font-weight: 500; word-break: keep-all; }
    .title-container { text-align: left; margin-bottom: 10px; }
    .main-title { font-size: 28px; font-weight: bold; color: #FFFFFF; margin-bottom: 5px; line-height: 1.2; }
    .sub-title { font-size: 14px; color: #CCCCCC; margin-bottom: 5px; line-height: 1.5; }
    .highlight { color: #00D4FF; font-weight: bold; }
    .weather-badge { background-color: #333; color: #fff; padding: 5px 10px; border-radius: 15px; font-size: 12px; margin-left: 10px; vertical-align: middle; }
    .engine-tag { display: inline-block; font-size: 11px; color: #00D4FF; border: 1px solid #00D4FF; padding: 4px 10px; border-radius: 15px; background-color: rgba(0, 212, 255, 0.05); margin-top: 5px; }
    .special-banner {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px; padding: 15px; margin: 10px 0; text-align: center;
    }
    .special-banner-title { font-size: 16px; font-weight: bold; color: #FFFFFF; }
    .special-banner-desc { font-size: 13px; color: #E0E0E0; margin-top: 5px; }
    .variable-box {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        border: 2px dashed #FFD93D; border-radius: 12px; padding: 15px; margin: 15px 0; text-align: center;
    }
    .variable-title { font-size: 12px; color: #FFD93D; margin-bottom: 5px; }
    .variable-content { font-size: 16px; color: #FFFFFF; font-weight: 500; }
</style>
""", unsafe_allow_html=True)

# --- 2. 업무지구 설정 ---
BUSINESS_DISTRICTS = {
    "종로/을지로": {"nx": 60, "ny": 127, "name": "종로"},
    "여의도": {"nx": 58, "ny": 126, "name": "여의도"},
    "강남/테헤란로": {"nx": 61, "ny": 126, "name": "강남"},
    "판교": {"nx": 62, "ny": 123, "name": "판교"},
    "마곡": {"nx": 58, "ny": 125, "name": "마곡"},
}

# --- 3. 아이콘 데이터 ---
ZODIAC_ICONS = {"물병자리": "🏺", "물고기자리": "🐟", "양자리": "🐏", "황소자리": "🐂", "쌍둥이자리": "👯", "게자리": "🦀", "사자자리": "🦁", "처녀자리": "🧚", "천칭자리": "⚖️", "전갈자리": "🦂", "사수자리": "🏹", "염소자리": "🐐"}
ANIMAL_ICONS = {"쥐": "🐭", "소": "🐮", "호랑이": "🐯", "토끼": "🐰", "용": "🐲", "뱀": "🐍", "말": "🐴", "양": "🐑", "원숭이": "🐵", "닭": "🐔", "개": "🐶", "돼지": "🐷"}

# --- 4. 운세 템플릿 데이터 ---
TEMPLATES = {
    # MBTI별 한줄운세
    "mbti_fortune": {
        "ISTJ": ["체계적으로 움직이면 승리", "오늘은 원칙대로 가는 게 답", "꼼꼼함이 빛나는 날", "루틴을 지키면 복이 온다", "조용히 실력 발휘하는 날"],
        "ISFJ": ["배려가 돌아오는 날", "묵묵히 하던 일이 인정받음", "팀원 덕에 웃는 날", "성실함이 보상받는다", "서포터 역할이 빛나는 날"],
        "INFJ": ["직감을 믿어도 되는 날", "조용히 관찰하면 기회 보임", "혼자만의 시간이 필요해", "깊은 생각이 해답을 준다", "공감 능력이 빛나는 날"],
        "INTJ": ["전략대로 움직이면 성공", "장기적 관점이 승리하는 날", "분석이 맞아떨어지는 날", "계획 수정은 내일로 미뤄", "논리로 설득하기 좋은 날"],
        "ISTP": ["문제 해결 능력 폭발하는 날", "손 대면 다 고쳐지는 날", "효율 최고인 날", "군더더기 없이 깔끔하게", "실용적 판단이 빛남"],
        "ISFP": ["감성이 통하는 날", "작은 것에서 행복 발견", "자기만의 속도로 가면 됨", "억지로 맞추지 마", "여유가 답인 날"],
        "INFP": ["창의력 터지는 날", "영감이 찾아오는 시간", "마음 가는 대로 해도 됨", "진정성이 통하는 날", "감정에 솔직하면 좋은 일 생김"],
        "INTP": ["호기심이 기회 만드는 날", "분석 모드 풀가동", "새로운 방법 시도 OK", "질문이 답을 만든다", "논리적 접근이 승리"],
        "ESTP": ["행동력이 빛나는 날", "일단 저지르면 되는 날", "순발력으로 해결 가능", "현장에서 답 찾는다", "에너지 넘치는 하루"],
        "ESFP": ["분위기 메이커 역할 추천", "사람 만나면 좋은 일 생김", "즉흥적 결정이 좋아", "재미를 찾으면 일도 술술", "웃으면 복이 와"],
        "ENFP": ["아이디어 폭발 예정", "열정이 전염되는 날", "새로운 시도 대환영", "가능성을 보면 기회", "에너지 조절만 잘 하면 됨"],
        "ENTP": ["토론하면 이기는 날", "창의적 해결책 떠오름", "도전이 기회 되는 날", "말빨이 통하는 날", "새로운 관점이 승리"],
        "ESTJ": ["리더십 발휘하기 좋은 날", "추진력으로 밀어붙여", "체계 잡으면 성공", "원칙 지키면 인정받음", "결단력이 빛나는 날"],
        "ESFJ": ["팀워크 최고인 날", "화합을 이끌면 좋은 일", "배려가 돌아오는 날", "사람 관계에서 행운", "분위기 띄우면 일도 술술"],
        "ENFJ": ["영향력이 커지는 날", "리드하면 따라오는 날", "공감으로 설득 성공", "비전 제시하면 통함", "사람들이 믿어주는 날"],
        "ENTJ": ["통솔력 최고인 날", "큰 그림 그리기 좋은 날", "결정하면 밀어붙여", "목표 향해 직진", "카리스마가 빛나는 날"],
    },
    
    # MBTI별 주의사항
    "mbti_warning": {
        "ISTJ": ["융통성 부족으로 충돌 주의", "너무 원칙만 고집하지 마", "변화에 열린 마음 필요", "완벽주의 내려놓기"],
        "ISFJ": ["남 일에 너무 신경 쓰지 마", "거절할 건 거절해", "자기 일 먼저 챙겨", "번아웃 주의"],
        "INFJ": ["혼자 끙끙대지 마", "오버 생각 주의", "완벽주의 내려놔", "현실 직시 필요"],
        "INTJ": ["고집 부리면 손해", "다른 의견도 들어봐", "감정 표현 필요할 수도", "융통성 발휘해"],
        "ISTP": ["무뚝뚝함 오해받기 쉬움", "팀워크도 신경 써", "혼자 처리하려 하지 마", "소통 한 번 더"],
        "ISFP": ["결정 미루지 마", "눈치 너무 보지 마", "의견 표현 필요해", "자기주장도 중요"],
        "INFP": ["현실 직시 필요", "감정에 휩쓸리지 마", "마감 시간 체크", "구체적 실행 필요"],
        "INTP": ["설명 길어지면 손해", "실행력 필요한 날", "딴 생각 주의", "결론부터 말해"],
        "ESTP": ["충동 결정 주의", "말 실수 조심", "디테일 놓치기 쉬움", "한 박자 쉬어가"],
        "ESFP": ["집중력 흐트러지기 쉬움", "수다 시간 조절", "중요한 거 놓치지 마", "우선순위 체크"],
        "ENFP": ["산만해지기 쉬운 날", "하나에 집중해", "약속 잊지 마", "마무리까지 신경 써"],
        "ENTP": ["논쟁 피해", "말 많으면 탈", "실행이 중요한 날", "끝까지 마무리해"],
        "ESTJ": ["너무 밀어붙이지 마", "팀원 감정도 챙겨", "독단적 결정 주의", "유연하게 대처"],
        "ESFJ": ["남 일에 너무 개입 말고", "자기 감정도 챙겨", "오지랖 주의", "에너지 분배 필요"],
        "ENFJ": ["다 책임지려 하지 마", "번아웃 주의", "거절도 필요해", "자기 시간 확보"],
        "ENTJ": ["강압적으로 보일 수 있음", "피드백 수용해", "팀원 의견도 들어", "속도 조절 필요"],
    },
    
    # 띠별 오늘의 기운
    "animal_energy": {
        "쥐": ["재빠른 판단력이 빛나는 날", "기회 포착 능력 상승", "정보력이 힘이 되는 날", "눈치 백단 발동", "작은 기회도 놓치지 마"],
        "소": ["우직한 추진력이 빛나는 날", "꾸준함이 결실 맺는 날", "인내가 보상받는 날", "묵묵히 가면 길이 열림", "끈기가 무기"],
        "호랑이": ["용맹함이 필요한 날", "과감한 결정 OK", "리더십 발휘 적기", "도전하면 성과", "당당하게 밀어붙여"],
        "토끼": ["재치가 빛나는 날", "위기 모면 능력 상승", "사교성으로 기회 잡아", "유연하게 대처", "부드러움이 강함"],
        "용": ["카리스마 폭발하는 날", "큰 일 도모하기 좋아", "주목받는 날", "스케일 크게 생각해", "자신감 충만"],
        "뱀": ["직감이 예리해지는 날", "통찰력으로 승부", "조용히 관찰하면 보임", "지혜가 빛나는 날", "신중함이 무기"],
        "말": ["열정 폭발하는 날", "활동적으로 움직여", "속도감 있게 처리", "에너지 넘치는 하루", "달리면 따라옴"],
        "양": ["온화함이 힘이 되는 날", "협력하면 시너지", "평화롭게 해결 가능", "조화가 답", "부드러움으로 승부"],
        "원숭이": ["재치와 유머가 통하는 날", "임기응변 능력 상승", "창의력 발휘 적기", "영리하게 대처", "유연함이 무기"],
        "닭": ["부지런함이 빛나는 날", "세심함으로 승부", "완벽주의가 통하는 날", "디테일이 차이 만듦", "성실함이 인정받음"],
        "개": ["신뢰가 쌓이는 날", "의리가 빛나는 날", "충직함이 인정받음", "믿음직한 모습 보여", "진심이 통함"],
        "돼지": ["복이 들어오는 날", "여유가 기회 만듦", "인복 터지는 날", "넉넉한 마음이 답", "행운이 따르는 날"],
    },
    
    # 띠별 주의사항
    "animal_warning": {
        "쥐": ["너무 계산적으로 보일 수 있음", "욕심 과하면 탈", "작은 이익에 큰 거 놓칠 수도"],
        "소": ["고집 피우면 손해", "융통성 필요한 날", "속도 조절 필요"],
        "호랑이": ["독단적 결정 주의", "성질 급하면 탈", "한 발 물러서기 필요"],
        "토끼": ["우유부단함 주의", "결단력 필요한 순간", "도망가지 말고 맞서"],
        "용": ["오만해 보일 수 있음", "팀워크 신경 써", "겸손함 필요"],
        "뱀": ["의심 과하면 기회 놓침", "너무 숨기지 마", "소통 한 번 더"],
        "말": ["급하면 실수", "끝까지 마무리 필요", "산만해지기 쉬움"],
        "양": ["우유부단함 주의", "자기주장도 필요해", "의존하지 마"],
        "원숭이": ["잔꾀 부리면 탈", "진정성 필요", "가벼워 보일 수 있음"],
        "닭": ["까다로워 보일 수 있음", "비판 줄이기", "완벽주의 내려놔"],
        "개": ["고지식해 보일 수 있음", "유연함 필요", "너무 직설적이면 탈"],
        "돼지": ["게을러 보일 수 있음", "결단력 필요", "우선순위 정해"],
    },
    
    # 별자리별 오전운
    "zodiac_morning": {
        "물병자리": ["창의적 아이디어 떠오르는 오전", "독특한 관점이 빛남", "혁신적 사고 발휘", "자유롭게 생각해도 OK"],
        "물고기자리": ["감성 충만한 오전", "직감이 잘 맞는 시간", "공감 능력 상승", "부드럽게 시작하면 좋아"],
        "양자리": ["에너지 충만한 오전", "첫 단추 잘 꿰는 시간", "주도적으로 시작해", "선제 행동 추천"],
        "황소자리": ["안정적으로 시작하는 오전", "차분하게 정리하기 좋아", "기초 작업 추천", "서두르지 마"],
        "쌍둥이자리": ["소통이 잘 되는 오전", "미팅하기 좋은 시간", "정보 수집 적기", "대화로 풀어가"],
        "게자리": ["팀 케어하기 좋은 오전", "분위기 파악 잘 됨", "배려가 돌아옴", "감정 교류 추천"],
        "사자자리": ["존재감 빛나는 오전", "발표/프레젠 적기", "주목받는 시간", "자신감 있게 나서"],
        "처녀자리": ["꼼꼼함이 빛나는 오전", "분석/검토 추천", "디테일 체크 적기", "완벽주의 발휘"],
        "천칭자리": ["균형 잡힌 판단의 오전", "조율하기 좋은 시간", "공정한 결정 가능", "중재 역할 추천"],
        "전갈자리": ["집중력 최고인 오전", "깊이 파고들기 좋아", "핵심 파악 적기", "몰입 추천"],
        "사수자리": ["긍정 에너지 충만한 오전", "새로운 도전 적기", "확장적 사고 OK", "낙관적으로 시작"],
        "염소자리": ["생산성 최고인 오전", "계획대로 실행 적기", "체계적 접근 추천", "목표 향해 집중"],
    },
    
    # 별자리별 오후운
    "zodiac_afternoon": {
        "물병자리": ["협업에서 시너지 나는 오후", "다른 관점 수용하면 좋아", "네트워킹 추천"],
        "물고기자리": ["마무리가 잘 되는 오후", "감성적 마무리 추천", "여운 남기는 시간"],
        "양자리": ["추진력 발휘하는 오후", "밀어붙이면 성과", "결단의 시간"],
        "황소자리": ["완성도 높이는 오후", "퀄리티 체크 적기", "마감 작업 추천"],
        "쌍둥이자리": ["정보 정리하는 오후", "보고/공유 추천", "멀티태스킹 OK"],
        "게자리": ["관계 다지는 오후", "1:1 대화 추천", "감사 표현 적기"],
        "사자자리": ["성과 정리하는 오후", "인정받는 시간", "셀프 PR 추천"],
        "처녀자리": ["최종 검토의 오후", "실수 잡아내는 시간", "꼼꼼 체크 추천"],
        "천칭자리": ["합의 이끄는 오후", "협상 추천", "윈윈 만들기 좋아"],
        "전갈자리": ["결론 내리는 오후", "핵심만 정리", "결단력 발휘"],
        "사수자리": ["계획 세우는 오후", "내일을 위한 준비", "큰 그림 그리기"],
        "염소자리": ["실적 정리하는 오후", "데이터 체크 추천", "보고 준비 적기"],
    },
    
    # 띠×별자리 궁합 (좋음/보통/주의 + 한줄 코멘트)
    "compatibility": {
        # 쥐
        ("쥐", "물병자리"): ("좋음", "영리함과 창의성의 시너지"),
        ("쥐", "물고기자리"): ("보통", "감성과 이성의 균형 필요"),
        ("쥐", "양자리"): ("좋음", "빠른 판단력 시너지"),
        ("쥐", "황소자리"): ("보통", "속도 차이 조절 필요"),
        ("쥐", "쌍둥이자리"): ("좋음", "정보력 최강 조합"),
        ("쥐", "게자리"): ("보통", "감정 교류 더 필요"),
        ("쥐", "사자자리"): ("주의", "주도권 충돌 가능"),
        ("쥐", "처녀자리"): ("좋음", "디테일 완벽 조합"),
        ("쥐", "천칭자리"): ("보통", "결정 속도 차이"),
        ("쥐", "전갈자리"): ("좋음", "통찰력 시너지"),
        ("쥐", "사수자리"): ("보통", "방향성 조율 필요"),
        ("쥐", "염소자리"): ("좋음", "목표 지향 완벽 조합"),
        # 소
        ("소", "물병자리"): ("주의", "고집 vs 자유 충돌"),
        ("소", "물고기자리"): ("보통", "속도 맞추면 OK"),
        ("소", "양자리"): ("주의", "추진 방식 차이"),
        ("소", "황소자리"): ("좋음", "안정감 최강 조합"),
        ("소", "쌍둥이자리"): ("주의", "변화 vs 고정 충돌"),
        ("소", "게자리"): ("좋음", "신뢰 기반 조합"),
        ("소", "사자자리"): ("보통", "리더십 조율 필요"),
        ("소", "처녀자리"): ("좋음", "꼼꼼함 시너지"),
        ("소", "천칭자리"): ("보통", "결정 방식 차이"),
        ("소", "전갈자리"): ("좋음", "끈기 시너지"),
        ("소", "사수자리"): ("주의", "속도 차이 큼"),
        ("소", "염소자리"): ("좋음", "실용주의 완벽 조합"),
        # 호랑이
        ("호랑이", "물병자리"): ("좋음", "혁신적 리더십"),
        ("호랑이", "물고기자리"): ("보통", "강함과 부드러움 균형"),
        ("호랑이", "양자리"): ("좋음", "용맹함 시너지"),
        ("호랑이", "황소자리"): ("주의", "주도권 충돌 가능"),
        ("호랑이", "쌍둥이자리"): ("보통", "방향성 맞추면 OK"),
        ("호랑이", "게자리"): ("보통", "보호 vs 독립 균형"),
        ("호랑이", "사자자리"): ("주의", "리더십 충돌 주의"),
        ("호랑이", "처녀자리"): ("보통", "디테일 보완 필요"),
        ("호랑이", "천칭자리"): ("좋음", "결단+균형 조합"),
        ("호랑이", "전갈자리"): ("좋음", "강인함 시너지"),
        ("호랑이", "사수자리"): ("좋음", "도전 정신 폭발"),
        ("호랑이", "염소자리"): ("보통", "목표 맞추면 강력"),
        # 토끼
        ("토끼", "물병자리"): ("좋음", "창의적 유연함"),
        ("토끼", "물고기자리"): ("좋음", "감성 시너지"),
        ("토끼", "양자리"): ("보통", "속도 조절 필요"),
        ("토끼", "황소자리"): ("좋음", "안정적 조화"),
        ("토끼", "쌍둥이자리"): ("좋음", "사교성 폭발"),
        ("토끼", "게자리"): ("좋음", "정서적 교감"),
        ("토끼", "사자자리"): ("보통", "자기주장 필요"),
        ("토끼", "처녀자리"): ("보통", "완벽주의 조절"),
        ("토끼", "천칭자리"): ("좋음", "조화로운 조합"),
        ("토끼", "전갈자리"): ("주의", "깊이 차이 조율"),
        ("토끼", "사수자리"): ("보통", "방향성 맞추기"),
        ("토끼", "염소자리"): ("보통", "목표 공유하면 OK"),
        # 용
        ("용", "물병자리"): ("좋음", "비전 시너지"),
        ("용", "물고기자리"): ("보통", "이상과 감성 균형"),
        ("용", "양자리"): ("좋음", "파워풀 조합"),
        ("용", "황소자리"): ("주의", "속도 차이 큼"),
        ("용", "쌍둥이자리"): ("좋음", "다재다능 시너지"),
        ("용", "게자리"): ("보통", "감정 교류 필요"),
        ("용", "사자자리"): ("주의", "주도권 경쟁"),
        ("용", "처녀자리"): ("보통", "디테일 보완 가능"),
        ("용", "천칭자리"): ("좋음", "균형 잡힌 리더십"),
        ("용", "전갈자리"): ("좋음", "카리스마 폭발"),
        ("용", "사수자리"): ("좋음", "확장 지향 완벽"),
        ("용", "염소자리"): ("보통", "목표 맞추면 강력"),
        # 뱀
        ("뱀", "물병자리"): ("보통", "독립성 충돌 가능"),
        ("뱀", "물고기자리"): ("좋음", "직감 시너지"),
        ("뱀", "양자리"): ("주의", "방식 차이 큼"),
        ("뱀", "황소자리"): ("좋음", "신중함 조합"),
        ("뱀", "쌍둥이자리"): ("주의", "소통 방식 차이"),
        ("뱀", "게자리"): ("보통", "감정 공유 필요"),
        ("뱀", "사자자리"): ("보통", "표현 방식 차이"),
        ("뱀", "처녀자리"): ("좋음", "분석력 시너지"),
        ("뱀", "천칭자리"): ("보통", "결정 방식 조율"),
        ("뱀", "전갈자리"): ("좋음", "통찰력 최강"),
        ("뱀", "사수자리"): ("주의", "깊이 vs 넓이"),
        ("뱀", "염소자리"): ("좋음", "전략적 조합"),
        # 말
        ("말", "물병자리"): ("좋음", "자유로운 에너지"),
        ("말", "물고기자리"): ("보통", "감성 균형 필요"),
        ("말", "양자리"): ("좋음", "열정 폭발"),
        ("말", "황소자리"): ("주의", "속도 차이 큼"),
        ("말", "쌍둥이자리"): ("좋음", "활발한 시너지"),
        ("말", "게자리"): ("보통", "안정 vs 자유"),
        ("말", "사자자리"): ("좋음", "에너지 시너지"),
        ("말", "처녀자리"): ("주의", "디테일 충돌"),
        ("말", "천칭자리"): ("보통", "균형 맞추기"),
        ("말", "전갈자리"): ("보통", "깊이 차이 조율"),
        ("말", "사수자리"): ("좋음", "모험 최강 조합"),
        ("말", "염소자리"): ("주의", "방식 차이 큼"),
        # 양
        ("양", "물병자리"): ("보통", "독립성 조율"),
        ("양", "물고기자리"): ("좋음", "감성 교감"),
        ("양", "양자리"): ("보통", "주도권 명확히"),
        ("양", "황소자리"): ("좋음", "평화로운 조합"),
        ("양", "쌍둥이자리"): ("보통", "소통 노력 필요"),
        ("양", "게자리"): ("좋음", "정서적 안정"),
        ("양", "사자자리"): ("보통", "지지 역할 명확히"),
        ("양", "처녀자리"): ("좋음", "섬세함 시너지"),
        ("양", "천칭자리"): ("좋음", "조화로운 균형"),
        ("양", "전갈자리"): ("주의", "깊이 차이"),
        ("양", "사수자리"): ("보통", "방향성 맞추기"),
        ("양", "염소자리"): ("보통", "실용성 공유"),
        # 원숭이
        ("원숭이", "물병자리"): ("좋음", "창의력 폭발"),
        ("원숭이", "물고기자리"): ("보통", "진정성 필요"),
        ("원숭이", "양자리"): ("좋음", "활력 시너지"),
        ("원숭이", "황소자리"): ("주의", "방식 차이"),
        ("원숭이", "쌍둥이자리"): ("좋음", "재치 최강 조합"),
        ("원숭이", "게자리"): ("보통", "감정 교류 필요"),
        ("원숭이", "사자자리"): ("좋음", "무대 장악 시너지"),
        ("원숭이", "처녀자리"): ("주의", "꼼꼼함 충돌"),
        ("원숭이", "천칭자리"): ("좋음", "사교성 폭발"),
        ("원숭이", "전갈자리"): ("주의", "진정성 의심"),
        ("원숭이", "사수자리"): ("좋음", "모험 시너지"),
        ("원숭이", "염소자리"): ("보통", "실용성 맞추기"),
        # 닭
        ("닭", "물병자리"): ("주의", "방식 차이 큼"),
        ("닭", "물고기자리"): ("보통", "감성 보완 필요"),
        ("닭", "양자리"): ("보통", "속도 조절"),
        ("닭", "황소자리"): ("좋음", "성실함 시너지"),
        ("닭", "쌍둥이자리"): ("주의", "디테일 충돌"),
        ("닭", "게자리"): ("보통", "감정 표현 필요"),
        ("닭", "사자자리"): ("보통", "인정 욕구 조율"),
        ("닭", "처녀자리"): ("좋음", "완벽주의 시너지"),
        ("닭", "천칭자리"): ("보통", "기준 맞추기"),
        ("닭", "전갈자리"): ("좋음", "집중력 시너지"),
        ("닭", "사수자리"): ("주의", "디테일 vs 큰그림"),
        ("닭", "염소자리"): ("좋음", "목표 지향 완벽"),
        # 개
        ("개", "물병자리"): ("보통", "가치관 맞추기"),
        ("개", "물고기자리"): ("좋음", "진심 교감"),
        ("개", "양자리"): ("보통", "충성 방향 명확히"),
        ("개", "황소자리"): ("좋음", "신뢰 기반 조합"),
        ("개", "쌍둥이자리"): ("주의", "진정성 의문"),
        ("개", "게자리"): ("좋음", "정서적 유대"),
        ("개", "사자자리"): ("좋음", "충성심 시너지"),
        ("개", "처녀자리"): ("좋음", "꼼꼼함 신뢰"),
        ("개", "천칭자리"): ("보통", "공정함 맞추기"),
        ("개", "전갈자리"): ("좋음", "깊은 신뢰"),
        ("개", "사수자리"): ("보통", "자유 vs 충성"),
        ("개", "염소자리"): ("좋음", "책임감 시너지"),
        # 돼지
        ("돼지", "물병자리"): ("보통", "방식 조율 필요"),
        ("돼지", "물고기자리"): ("좋음", "감성 충만"),
        ("돼지", "양자리"): ("보통", "에너지 맞추기"),
        ("돼지", "황소자리"): ("좋음", "여유 시너지"),
        ("돼지", "쌍둥이자리"): ("보통", "깊이 차이"),
        ("돼지", "게자리"): ("좋음", "편안한 조합"),
        ("돼지", "사자자리"): ("보통", "주도권 명확히"),
        ("돼지", "처녀자리"): ("보통", "완벽주의 조절"),
        ("돼지", "천칭자리"): ("좋음", "평화로운 조합"),
        ("돼지", "전갈자리"): ("보통", "깊이 맞추기"),
        ("돼지", "사수자리"): ("좋음", "낙관 시너지"),
        ("돼지", "염소자리"): ("보통", "실용성 공유"),
    },
    
    # 요일유형별 전략 (상세하게)
    "day_type_morning": {
        "월요일": [
            "월요일 오전은 속도보다 방향이 중요해. 메일함부터 훑고 이번 주 핵심 업무 3개만 체크해두면 한 주가 편해져",
            "월요병 이기는 법: 출근하자마자 가장 쉬운 업무 하나 끝내봐. 작은 성취감이 엔진을 켜줌 🔥",
            "월요일 오전 회의가 있다면 5분 일찍 도착해서 자리 잡아. 첫인상이 한 주를 좌우할 수 있어",
            "커피 한 잔 마시면서 지난주 금요일에 뭐 했는지 30초만 복기해봐. 오늘 할 일이 자연스럽게 정리됨",
            "월요일 오전은 급하지 않은 메일 답장부터 시작해. 천천히 페이스 올리면서 중요한 건 10시 이후에 처리해",
        ],
        "평일": [
            "오전에 집중이 잘 되는 시간이야. 가장 머리 쓰는 업무를 지금 처리하면 오후가 훨씬 편해져",
            "오전 미팅이 있다면 어젯밤에 정리해둔 포인트 한 번만 더 확인하고 들어가. 준비된 사람이 회의를 리드해",
            "출근 직후 10분은 오늘의 우선순위 정리에 써봐. To-Do 3개만 적어두면 하루가 깔끔하게 흘러가",
            "오전에 상사에게 먼저 현황 공유하면 오후에 갑자기 불려갈 일이 줄어들어. 선제 보고가 생존 스킬!",
            "집중 업무가 있다면 오전 중으로 끝내는 게 좋아. 점심 먹고 나면 집중력이 확 떨어지거든",
        ],
        "금요일": [
            "금요일 오전이 이번 주의 마지막 골든타임! 밀린 업무 중 급한 것만 골라서 오전에 끝내자",
            "주간 보고가 있다면 금요일 오전에 미리 정리해두면 칼퇴 확률이 올라가. 오후는 정리 시간으로 남겨",
            "금요일이라 마음은 벌써 주말인데, 오전에 핵심 업무 하나만 더 마무리하면 주말이 더 행복해져",
            "오전에 다음 주 월요일 해야 할 일을 가볍게 메모만 해둬. 그러면 주말 내내 '뭐 해야하지' 고민 안 해도 돼",
            "금요일 오전은 동료들도 컨디션 좋은 시간이야. 협업이 필요한 일 있으면 지금 말 걸어봐",
        ],
        "연휴전날": [
            "연휴 전날이라 들뜨지만, 오전에 인수인계 메모 하나만 작성해두면 연휴가 진짜 편안해져",
            "오늘 안에 꼭 처리해야 하는 건 리스트업부터! 연휴 전날은 필수만 처리하고 깔끔하게 마무리하자",
            "급한 메일 답장은 오전 중으로 끝내고, 연휴 중에 연락 올 일 없게 세팅해두는 게 진짜 휴식 스킬",
            "오전에 팀원들에게 '연휴 즐겨요~' 인사 한마디 건네면 분위기도 좋고, 연휴 후 복귀도 부드러워져",
            "자동 부재중 메일 설정하고, 긴급 연락처만 공유해두면 마음 편하게 쉴 수 있어",
        ],
        "주말": [
            "주말 오전은 평일에 못 했던 자기 케어 시간! 늦잠 자도 좋고, 카페에서 여유롭게 책 한 권도 좋아",
            "주말이니까 알람 없이 자연스럽게 일어나봐. 몸이 원하는 리듬대로 움직이는 게 최고의 충전",
            "평일에 밀린 개인 정리가 있다면 오전에 가볍게 처리하고 오후는 온전히 쉬는 시간으로!",
            "주말 오전 산책이나 가벼운 운동으로 시작하면 하루가 2배로 길어지는 느낌이야",
            "오전에 뭐 할지 고민된다면 그냥 아무것도 안 해도 돼. 쉬는 것도 숙련이 필요한 기술이야 ㅋㅋ",
        ],
        "공휴일": [
            "평일인데 쉬는 날! 이런 날은 하고 싶었는데 못 했던 것 하나만 해보면 기분이 두 배",
            "공휴일은 예상치 못한 선물 같은 날이야~ 죄책감 없이 오전부터 늘어져도 괜찮아",
            "오전에 맛집 브런치 한 끼로 시작하면 하루가 특별해져. 평일엔 못 가는 그 식당, 오늘이 기회야",
            "재충전이 오늘의 목표! 푹 자고, 맛있는 거 먹고, 좋아하는 사람과 시간 보내면 성공",
        ],
    },
    "day_type_afternoon": {
        "월요일": [
            "월요일 오후는 졸음과의 전쟁이야. 점심 후 5분만 스트레칭하고 오면 집중력이 살아나",
            "오후 회의가 있다면 핵심만 간결하게. 월요일 오후에 긴 회의는 모두를 지치게 해",
            "오후 3시에 눈이 감기면 탕비실에서 찬물 한 잔 마시고 와. 커피보다 효과 좋을 수도",
            "월요일 오후는 무리하지 말고, 내일을 위한 세팅에 집중해. 이번 주 스케줄 체크하면 마음이 편해져",
            "오후에 상사한테 이번 주 진행 방향 한 줄만 보고해두면, 화요일부터 자율도가 올라가",
        ],
        "평일": [
            "점심 먹고 나면 집중력이 뚝 떨어지지? 오후 첫 30분은 단순 작업으로 워밍업하고 본격 업무 시작해봐",
            "오후 3시 이전에 중요한 보고는 끝내는 게 좋아. 상사도 오후 늦으면 퇴근 모드라 집중 안 해",
            "남은 업무를 '오늘 안에 끝낼 것'과 '내일로 넘길 것'으로 분류해봐. 마무리가 깔끔해져",
            "동료에게 도움이 필요한 일이 있다면 오후 4시 전에 부탁해. 너무 늦으면 서로 부담돼",
            "오후에 갑작스런 업무가 들어오면 일단 수락하고, 기존 일정 조율이 필요하면 상사에게 말해. 무작정 안고 가면 야근",
        ],
        "금요일": [
            "금요일 오후는 주간 정리 시간! 이번 주 성과를 간단히 메모해두면 다음 주 보고가 편해져",
            "오후에는 급한 것만 처리하고 다음 주 세팅에 투자해. 월요일 아침에 감사할 거야",
            "퇴근 전에 책상 한 번 정리하고 가면 월요일에 기분 좋게 출근할 수 있어",
            "금요일 오후에 팀원들과 가볍게 이번 주 회고 나눠보면 분위기도 좋고 주말이 더 개운해",
            "다음 주 핵심 업무 3개만 메모해두고 퇴근하면 '월요일 뭐 하지?' 걱정 없이 주말 보낼 수 있어",
        ],
        "연휴전날": [
            "연휴 전날 오후는 정리 시간! 진행 중인 업무 현황만 간단히 메모해두면 연휴 후 복귀가 부드러워",
            "급한 건만 처리하고, 나머지는 과감히 연휴 후로. 오늘 무리하면 연휴가 회복에 쓰이게 돼",
            "팀 메신저에 부재 기간 공유하고, 긴급 시 연락 방법만 안내해. 깔끔한 마무리가 진짜 프로",
            "인수인계 문서 공유하고 마음 편히 퇴근 준비! 오늘은 좀 일찍 나가도 아무도 뭐라 안 해 ㅋㅋ",
        ],
        "주말": [
            "주말 오후는 진짜 내 시간이야! 약속이 있으면 신나게, 없으면 넷플릭스도 좋고 낮잠도 좋고",
            "뭔가 하고 싶은데 뭘 할지 모르겠으면 밀린 드라마 한 편이 답이야. 평일엔 이것도 사치잖아",
            "밖으로 나가기 좋은 오후야! 가까운 카페나 공원에서 잠깐이라도 환기하면 에너지 리필 완료",
            "주말 오후에 평일 점심에 가보고 싶었던 맛집 탐방도 좋아. 웨이팅 없이 갈 수 있는 건 주말의 특권",
        ],
        "공휴일": [
            "공휴일 오후는 보너스 타임! 평소에 못 했던 취미 활동이나 사람 만남으로 에너지 충전해",
            "여유로운 오후를 만끽해~ 내일 출근이라도 오늘은 오늘이야. 후회 없이 보내자",
            "오후에 가벼운 산책하면서 머리 비우면 내일 업무가 더 잘 풀려. 리프레시가 생산성이야",
        ],
    },
    "day_type_evening": {
        "월요일": [
            "월요일 저녁은 무리하지 말고 일찍 퇴근해서 쉬어. 이번 주는 아직 4일이나 남았으니까 페이스 조절 필수!",
            "퇴근 후 약속이 없다면 집에서 좋아하는 음식 시켜 먹으면서 충전해. 월요일 저녁만큼은 나한테 투자하자",
            "집에 가는 길에 편의점에서 간식 하나 사면서 자기 보상해줘. 월요일 버틴 나 자신 칭찬 ㅋㅋ",
            "무리한 약속은 화~목에 잡는 게 좋아. 월요일 저녁은 체력 충전이 최우선이야",
            "오늘 하루 잘 버텼으면 그걸로 100점! 일찍 자고 내일 개운하게 시작하자",
        ],
        "평일": [
            "퇴근 후에 가벼운 운동이나 산책 한 바퀴 돌면 수면의 질이 확 올라가. 30분이면 충분해",
            "저녁에 적당한 약속 하나 정도는 좋아. 사람 만나는 에너지가 내일 출근 동력이 될 수도 있어",
            "취미 활동 하기 좋은 저녁이야! 운동이든 독서든 게임이든, '나만의 시간'이 번아웃을 막아줘",
            "내일 준비는 퇴근 전에 끝내고, 저녁은 온전히 충전 시간으로. 일과 쉼의 구분이 생산성의 비결",
            "퇴근길에 좋아하는 음악 들으면서 오늘 잘한 것 하나만 떠올려봐. 작은 성취감이 내일의 원동력",
        ],
        "금요일": [
            "불금이다! 🍻 약속 있으면 신나게, 없으면 혼술/혼영으로 한 주의 피로를 날려버려",
            "금요일 저녁은 맘껏 늦게까지 놀아도 돼. 내일은 주말이니까! 스트레스는 오늘 밤에 다 풀자",
            "주말 시작을 축하하면서 평소 안 가던 맛집 가보거나, 보고 싶었던 영화 보는 건 어때?",
            "금요일 저녁에 하고 싶은 거 리스트 정하고 마음껏 즐겨. 이번 주도 고생한 나에게 선물하자!",
        ],
        "연휴전날": [
            "연휴 시작이야! 🎉 여행 계획이 있다면 설레는 마음 안고 짐 챙기고, 없다면 느긋하게 연휴 즐기기 모드 ON",
            "연휴 전날 저녁은 그 자체로 축제야. 맛있는 거 먹고, 좋아하는 사람이랑 연락하고, 푹 쉴 준비하자",
            "내일부터 자유! 오늘 밤은 늦게까지 하고 싶은 거 하면서 평일 스트레스 완전 리셋하자",
        ],
        "주말": [
            "주말 저녁은 시간 제한 없이 내 마음대로! 늦게까지 영화 봐도 되고, 일찍 자도 되고, 자유야",
            "내일도 쉬는 날이니까 뭘 해도 OK. 친구들 만나거나, 혼자만의 시간을 즐기거나, 마음 가는 대로!",
            "주말 저녁에 다음 주 간식이나 도시락거리 장보면 월요일이 좀 덜 무서워져 ㅋㅋ",
        ],
        "공휴일": [
            "공짜 휴일의 저녁이니까 내일 출근이래도 오늘만큼은 푹 쉬어. 재충전 완료하고 내일은 새 마음으로!",
            "오늘 하루 선물 같은 날이었어. 감사한 마음으로 마무리하고, 내일을 위한 가벼운 준비만 하자",
        ],
    },
    
    # 시간대별 인트로 메시지
    "time_intro": {
        "출근길": ["📡 오늘 하루 생존 전략 미리보기!", "🚶 출근길 운세가 도착했어!", "📋 오늘의 작전 브리핑 시작!"],
        "오전": ["☕ 오전 집중 모드 ON! 지금이 골든타임", "🔥 오전 전략 체크 완료! 움직일 때야", "📊 지금 뭐 하면 좋을지 알려줄게"],
        "점심": ["🍱 점심시간 잠깐 쉬면서 오후 전략 체크!", "⏸️ 반환점 돌았다! 오후를 위한 충전 시간", "🍽️ 점심 먹고 기운 차려서 오후도 파이팅!"],
        "오후": ["🌆 오후 전략 수정! 남은 시간 알차게", "⚡ 마무리 스퍼트 준비!", "🎯 남은 시간을 위한 공략법 도착"],
        "퇴근후": ["🌙 오늘 하루 수고했어! 내일을 위한 충전 시간", "🏠 퇴근 후 힐링 타임 ✨", "💤 오늘도 잘 버텼다! 푹 쉬어"],
    },
    
    # 계절/월별 감성
    "season_vibe": {
        "신년": ["새해 기운 충만! 올해의 새 출발 에너지가 가득한 날이야 🎊", "올해는 진짜 다를 거야! 새해 첫 달의 기운을 놓치지 마", "새로운 다짐과 목표를 세우기 딱 좋은 시기! 지금의 열정을 기억해둬"],
        "봄": ["봄기운이 솔솔~ 새 프로젝트 시작하거나 도전하기 좋은 에너지가 넘치는 시즌 🌸", "설렘 가득한 봄! 움츠렸던 기운을 펼칠 때야. 작은 변화가 큰 기회를 만들어", "따뜻한 바람처럼 새로운 인연과 기회가 찾아오는 시즌이야"],
        "초여름": ["에너지 넘치는 초여름! 점심시간에 잠깐 밖에 나가면 활력 충전 가능 ☀️", "야외 미팅이나 워킹 런치 하기 좋은 날씨! 분위기 전환 겸 밖에서 한 끼 해봐", "열정 불태우기 좋은 시즌! 여름 휴가 전에 성과 한 건 만들어보자"],
        "장마": ["눅눅한 장마 시즌이라 실내 집중 업무에 더 적합해! 비 소리가 오히려 집중력을 높여줄 수도 ☔", "비 오는 날은 따뜻한 음료와 함께 딥 워크하기 좋아. 우중충한 기분은 맛있는 점심으로 날려!", "우산 챙기는 것도 일이지만, 장마 시즌은 의외로 일이 잘 풀리는 때야"],
        "한여름": ["더위와의 전쟁 시즌! 🥵 에어컨 앞자리를 사수하고, 아이스커피로 체력 관리하자", "무더위에 체력 관리가 핵심이야. 점심 후 잠깐 눈 감고 명상 5분이 에너지 리필의 비결", "시원한 곳에서 효율적으로! 무리하지 말고 쿨하게 일하자"],
        "가을": ["결실의 계절! 🍂 올해 목표한 것들 마무리 짓기 좋은 때. 집중력이 최고인 시즌이야", "선선한 바람과 함께 차분하게 정리하는 시즌. 연말 전에 성과를 만들어보자", "가을은 모든 게 잘 되는 느낌이야. 이 컨디션 유지하면서 연말까지 달려보자!"],
        "연말": ["한 해 마무리 시즌! 🎄 올해 잘한 것들 돌아보면서 내년 계획도 슬슬 세워보자", "송년 감성 물씬한 시즌이야. 일 마무리도 중요하지만 주변 사람들에게 감사 인사 전하는 것도 잊지 마", "연말 정산, 연말 회식, 연말 정리... 바쁘지만 보람찬 시즌! 올해도 수고했어"],
    },
    
    # 날씨별 점심 팁
    "weather_lunch": {
        "맑음": [
            "날씨가 좋으니 밖에서 점심 먹고 15분 산책해봐! 오후 집중력이 확 달라져 ☀️",
            "오늘 같은 날은 평소 안 가던 좀 멀리 있는 맛집 도전해봐. 걸어가면서 기분 전환도 되고!",
            "햇살 충전이 곧 비타민 D 충전! 창가 자리에서 밥 먹거나, 공원 벤치에서 테이크아웃도 추천",
            "맑은 날엔 가볍게 샐러드나 포케볼 어때? 오후에 졸리지 않게 도와줄 거야",
        ],
        "흐림": [
            "흐린 날은 든든한 한 끼가 특효약! 찌개류나 덮밥 같은 따뜻한 메뉴로 기분 UP 📈",
            "실내에서 따뜻한 국물 메뉴로 몸과 마음을 데워보자. 된장찌개에 밥 한 공기면 오후가 든든해",
            "식후 커피는 필수! 흐린 날은 카페라떼처럼 부드러운 거로 마시면서 잠깐 여유 부려봐",
            "오늘 같은 날은 동료 2~3명이서 따뜻한 거 먹으러 가면 분위기도 좋고 팀워크도 살아나",
        ],
        "비": [
            "비 오는 날엔 가까운 곳에서 따뜻한 국물이 진리! 🍲 우동, 칼국수, 순두부찌개 강추",
            "우산 챙기기 귀찮으면 배달시켜서 팀원들이랑 같이 먹는 것도 좋아. 비 오는 날 배달은 감성이야",
            "비 오는 날 파전에 막걸리... 는 점심이니까 파전만! 🥞 사무실 근처 분식집 가서 따뜻한 거 먹어",
            "젖은 발로 멀리 갈 필요 없어. 회사 1층이나 근처에서 빠르게 먹고, 오후 컨디션 관리가 중요해",
        ],
        "눈": [
            "눈 오는 날은 미끄러우니까 가까이서 따뜻하게! ❄️ 뚝배기 불고기나 김치찜 같은 뜨끈한 메뉴 GO",
            "눈 구경하면서 창가에서 따뜻한 국밥 한 그릇이면 행복 지수 MAX! 오후도 든든하게 보낼 수 있어",
            "미끄러움 주의보! 무리해서 멀리 가지 말고, 눈 녹으면 질퍽해지니 가까운 데서 빠르게 해결하자",
        ],
    },
    
    # 직장인 꿀팁 (상사/동료/업무)
    "office_tips": [
        "오늘은 상사에게 점심 먹고 간단히 현황 보고하면 좋은 날이야. 선제 보고가 신뢰를 쌓아!",
        "주변 동료에게 먼저 '뭐 도와줄 거 없어?'라고 물어보면 의외의 좋은 일이 생길 수 있어",
        "오늘은 팀 메신저에 긍정적인 리액션 한 번 더 달아봐. 작은 이모지가 팀 분위기를 바꿔 🎯",
        "이메일 답장은 간결하되 따뜻하게! '확인했습니다. 감사합니다😊' 한 줄이 인상을 좌우해",
        "오늘 회의에서 발언할 기회가 오면 짧고 핵심만. 긴 말보다 '핵심 한 줄'이 임팩트 있어",
        "상사의 말에 바로 반박하기보다 '좋은 포인트인데, 추가로 이런 것도 있어요'식으로 풀어봐",
        "동료가 고생하고 있으면 커피 한 잔 사주면서 '힘들지?' 한마디 건네봐. 사소한 배려가 큰 힘이 돼",
        "보고서는 결론부터 쓰는 습관! 상사는 바쁘니까 핵심 → 근거 → 상세 순서로 작성하면 점수 UP",
        "점심시간에 다른 팀 사람이랑 밥 먹어봐. 의외의 정보나 협업 기회를 발견할 수 있어",
        "미팅 후 5분 안에 회의록 요약 메일 보내면 '일 잘하는 사람' 이미지 획득! ✉️",
        "오후에 상사에게 보고할 때는 3~4시 사이가 골든타임이야. 너무 늦으면 퇴근 모드라 집중 안 해",
        "어려운 요청을 받았을 때 바로 '안 돼요' 대신 '이렇게 하면 가능합니다'로 대안을 제시해봐",
        "슬랙이나 카톡에 답장 늦을 것 같으면 '확인했어요, 좀 이따 답 드릴게요' 한 줄만 보내도 인상 달라져",
        "오늘은 점심 먹으면서 옆자리 동료한테 주말에 뭐 했냐고 가볍게 물어봐. 관계 유지의 기본이야",
        "퇴근 전 5분, 내일 할 일 Top 3만 적어두면 내일 아침이 훨씬 가벼워져. 습관 하나가 생산성을 만들어",
    ],

    # 점심 메뉴 추천
    "lunch_menu": [
        "오늘 점심은 든든한 제육볶음 어때? 🍚 오후에 힘이 필요한 날이야",
        "기분 전환 겸 일식 덮밥 한 그릇 추천! 연어덮밥이나 규동이면 오후가 행복해져 🍣",
        "오늘은 칼국수 같은 면 요리가 끌리는 날! 따뜻한 국물에 씻은 듯이 기분 리셋",
        "팀원들이랑 고기 구워 먹으러 가봐! 🥩 삼겹살 파티가 팀워크의 시작이야",
        "가벼운 게 당긴다면 김밥+떡볶이 조합 ㅋㅋ 추억의 분식으로 기분 UP!",
        "오늘은 베트남 쌀국수 한 그릇 어때? 깔끔하면서 든든하고 오후도 가볍게~",
        "한식 백반 한 상이 그리운 날이야. 집밥 느낌으로 따뜻하게 먹으면 오후가 편안해져",
        "피자 한 판 시켜서 팀이랑 나눠 먹는 건? 🍕 분위기도 좋고 소통도 되고",
        "파스타나 리조또 같은 양식으로 분위기 전환! 와인 대신 탄산수로 건배 ㅋㅋ",
        "오늘은 홀 버거 한 입 크게 🍔 스트레스 날리기엔 육즙 가득한 메뉴가 최고야",
    ],

    
    # 행운템 리스트
    "lucky_items": [
        "빨간 포스트잇", "파란 포스트잇", "노란 형광펜", "3색 볼펜", "검정 볼펜",
        "미니 선인장 화분", "작은 화분", "탕비실 종이컵", "머그컵", "텀블러 뚜껑",
        "모니터 스티커", "캐릭터 피규어", "손목 쿠션", "마우스 패드", "키보드 브러쉬",
        "블루라이트 안경", "안경닦이", "이어폰 케이스", "에어팟 케이스", "보조 배터리",
        "명함 지갑", "사원증 목걸이", "차키 고리", "손거울", "핸드크림",
        "립밤", "책상 달력", "포켓 수첩", "클립 홀더", "스테이플러",
    ],
    
    # 띠별 행운템 연결 이유
    "lucky_item_reason": {
        "쥐": "재빠른 {animal}띠에게 민첩함을 더해줄",
        "소": "우직한 {animal}띠의 끈기를 상징하는",
        "호랑이": "용맹한 {animal}띠의 기운을 북돋울",
        "토끼": "재치있는 {animal}띠의 행운을 부르는",
        "용": "강력한 {animal}띠의 카리스마를 높여줄",
        "뱀": "지혜로운 {animal}띠의 통찰력을 키워줄",
        "말": "열정적인 {animal}띠의 에너지를 채워줄",
        "양": "온화한 {animal}띠의 평화를 지켜줄",
        "원숭이": "영리한 {animal}띠의 재치를 살려줄",
        "닭": "부지런한 {animal}띠의 성실함을 빛내줄",
        "개": "충직한 {animal}띠의 신뢰를 높여줄",
        "돼지": "복 많은 {animal}띠의 행운을 배로 만들",
    },
    
    # 오늘의 변수 (랜덤 요소)
    "random_variable": [
        "엘리베이터에서 만나는 사람이 오늘의 키맨",
        "오후 3시에 뜻밖의 연락이 올 수도",
        "빨간색 보이면 일단 멈춰봐",
        "오늘 첫 번째로 마주친 동료가 힌트",
        "점심 메뉴 선택이 오후를 좌우함",
        "갑자기 떠오르는 아이디어 메모해둬",
        "창밖을 한 번 보면 영감이 올지도",
        "오늘 들은 노래 가사에 답이 있을 수도",
        "커피 마시는 타이밍이 중요한 날",
        "회의실 자리 선택이 운명을 가름",
        "오후에 예상치 못한 칭찬이 올지도",
        "복도에서 스치는 인연 주목",
        "오늘 받는 첫 메일에 힌트가",
        "탕비실에서 좋은 정보 들을 수도",
        "계단 이용하면 좋은 기운",
        "오른쪽에서 오는 기회 잡아",
        "점심 후 5분 명상이 오후를 바꿈",
        "오늘은 질문을 많이 하면 좋아",
        "메모장 첫 페이지에 행운이",
        "화분에 물 주면 좋은 일 생김",
        "오늘 처음 본 숫자가 행운의 숫자",
        "웃는 얼굴이 기회를 부름",
        "오후에 자리 정리하면 운 상승",
        "동료의 농담에 진짜 힌트가 숨어있음",
        "오늘은 먼저 인사하는 사람이 이김",
        "컴퓨터 바탕화면 바꾸면 기분 전환",
        "오래된 파일에서 필요한 거 발견할 수도",
        "의외의 사람에게서 도움 받을 날",
        "모니터 밝기 조절이 집중력 높임",
        "오늘은 왼손으로 뭔가 해보는 건?",
        "책상 위 물건 위치가 운을 바꿈",
        "오후 간식이 에너지를 좌우함",
        "오늘 신는 양말 색깔이 포인트",
        "예상 못한 회의가 기회될 수도",
        "퇴근길 평소와 다른 길로 가봐",
        "SNS에서 본 글이 힌트일 수도",
        "오늘은 고민 말고 바로 실행",
        "책상 서랍 정리하면 잃어버린 거 나옴",
        "동기와 대화에서 인사이트 얻을 날",
        "오늘 점심값 누가 내면 둘 다 행운",
    ],
    
    # 특수일 메시지
    "special_day": {
        "양력생일": ["🎂 오늘 양력 생일! 특별한 하루 되길", "생일 축하해! 오늘은 네가 주인공", "1년 중 가장 특별한 날, 행운 가득"],
        "음력생일": ["🎂 오늘 음력 생일! 전통적 행운의 날", "음력 생일 축하! 어른들 축복 가득", "진짜 생일 기운 충만한 날"],
        "공휴일": ["🎉 공휴일! 평일인데 쉬는 행운", "쉬는 날 만끽해!", "재충전의 날, 푹 쉬어"],
        "연휴전날": ["🌴 내일부터 연휴! 오늘만 버텨", "설렘 안고 마무리하는 날", "연휴 직전 특별한 기운"],
        "월초": ["📅 새 달의 시작! 이번 달 목표 세워봐", "월초 기운으로 새출발", "리셋하고 다시 시작"],
        "월말": ["📊 월말 정산 시즌! 마무리 잘 하자", "한 달 마무리하는 날", "정리하고 다음 달 준비"],
        "분기말": ["📈 분기 마감! 실적 정리 필수", "3개월 성과 점검 시기", "다음 분기 준비 시작"],
        "연초": ["🎊 새해 시작! 올해는 다를 거야", "1년 계획 세우기 최적기", "새해 기운 물씬"],
        "연말": ["🎄 한 해 마무리! 수고했어", "올해 회고하기 좋은 때", "내년을 위한 정리"],
    },
}

# --- 5. 유틸리티 함수 ---
@st.cache_data(ttl=1800)
def get_weather(nx, ny, district_name):
    try:
        base_date = datetime.datetime.now().strftime("%Y%m%d")
        base_time = (datetime.datetime.now() - datetime.timedelta(minutes=40)).strftime("%H00")
        url = "http://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getUltraSrtNcst"
        params = {"serviceKey": WEATHER_API_KEY, "dataType": "JSON", "base_date": base_date, "base_time": base_time, "nx": nx, "ny": ny}
        res = requests.get(url, params=params, timeout=3).json()
        items = res['response']['body']['items']['item']
        data = {i['category']: i['obsrValue'] for i in items}
        pty, temp = int(data.get('PTY', 0)), data.get('T1H', '?')
        if pty == 0:
            icon, condition = "☀️", "맑음"
        elif pty in [1, 5]:
            icon, condition = "☔", "비"
        elif pty in [2, 6]:
            icon, condition = "🌨️", "눈"
        else:
            icon, condition = "☁️", "흐림"
        return icon, f"{temp}℃", condition
    except:
        return "📡", "수신불가", "흐림"

def get_lunar_date(date_obj):
    cal = KoreanLunarCalendar()
    cal.setSolarDate(date_obj.year, date_obj.month, date_obj.day)
    return cal.LunarIsoFormat()

def get_today_lunar():
    """오늘 날짜를 음력으로 변환"""
    today = datetime.date.today()
    cal = KoreanLunarCalendar()
    cal.setSolarDate(today.year, today.month, today.day)
    return (cal.lunarMonth, cal.lunarDay)

def get_zodiac_sign(day, month):
    md = month * 100 + day
    if 120 <= md <= 218: return "물병자리"
    elif 219 <= md <= 320: return "물고기자리"
    elif 321 <= md <= 419: return "양자리"
    elif 420 <= md <= 520: return "황소자리"
    elif 521 <= md <= 621: return "쌍둥이자리"
    elif 622 <= md <= 722: return "게자리"
    elif 723 <= md <= 822: return "사자자리"
    elif 823 <= md <= 922: return "처녀자리"
    elif 923 <= md <= 1022: return "천칭자리"
    elif 1023 <= md <= 1122: return "전갈자리"
    elif 1123 <= md <= 1224: return "사수자리"
    else: return "염소자리"

def get_ipchun_date(year):
    if year in [2021, 2025]: return datetime.date(year, 2, 3)
    if 1920 <= year <= 1984 and (year % 4 == 0): return datetime.date(year, 2, 5)
    return datetime.date(year, 2, 4)

def get_korean_zodiac(date_obj):
    year = date_obj.year
    target_year = year if date_obj >= get_ipchun_date(year) else year - 1
    animals = ["원숭이", "닭", "개", "돼지", "쥐", "소", "호랑이", "토끼", "용", "뱀", "말", "양"]
    return animals[target_year % 12]

def get_day_type(date_obj):
    """요일 유형 반환: 월요일/금요일/평일/주말/공휴일/연휴전날"""
    kr_holidays = holidays.KR()
    tomorrow = date_obj + datetime.timedelta(days=1)
    
    # 공휴일 체크
    if date_obj in kr_holidays:
        return "공휴일", kr_holidays.get(date_obj)
    
    # 연휴 전날 체크 (내일이 공휴일이거나 주말)
    if tomorrow in kr_holidays or tomorrow.weekday() >= 5:
        if date_obj.weekday() < 5:  # 평일인 경우만
            return "연휴전날", None
    
    # 주말 체크
    if date_obj.weekday() >= 5:
        return "주말", None
    
    # 월요일/금요일 특별 취급
    if date_obj.weekday() == 0:
        return "월요일", None
    elif date_obj.weekday() == 4:
        return "금요일", None
    
    return "평일", None

def get_time_slot():
    """현재 시간대 반환"""
    hour = datetime.datetime.now().hour
    if 6 <= hour < 9:
        return "출근길"
    elif 9 <= hour < 12:
        return "오전"
    elif 12 <= hour < 14:
        return "점심"
    elif 14 <= hour < 18:
        return "오후"
    else:
        return "퇴근후"

def get_season(date_obj):
    """계절/시즌 반환"""
    month = date_obj.month
    day = date_obj.day
    
    # 연초 (1월 1-7일)
    if month == 1 and day <= 7:
        return "신년"
    # 연말 (12월 20-31일)
    elif month == 12 and day >= 20:
        return "연말"
    # 봄 (3-5월)
    elif 3 <= month <= 5:
        return "봄"
    # 장마 (6월 중순 - 7월 중순)
    elif (month == 6 and day >= 15) or (month == 7 and day <= 20):
        return "장마"
    # 초여름 (6월 초)
    elif month == 6 and day < 15:
        return "초여름"
    # 한여름 (7월 중순 - 8월)
    elif (month == 7 and day > 20) or month == 8:
        return "한여름"
    # 가을 (9-11월)
    elif 9 <= month <= 11:
        return "가을"
    # 기본
    else:
        return "봄"

def get_special_days(birth_date, today):
    """특수일 체크"""
    special = []
    
    # 양력 생일
    if birth_date.month == today.month and birth_date.day == today.day:
        special.append("양력생일")
    
    # 음력 생일 체크
    birth_lunar = get_lunar_date(birth_date)  # 생일의 음력 변환
    today_lunar_month, today_lunar_day = get_today_lunar()
    
    # 음력 생일에서 월/일 추출 (형식: YYYY-MM-DD)
    birth_lunar_parts = birth_lunar.split('-')
    if len(birth_lunar_parts) >= 3:
        birth_lunar_month = int(birth_lunar_parts[1])
        birth_lunar_day = int(birth_lunar_parts[2])
        if birth_lunar_month == today_lunar_month and birth_lunar_day == today_lunar_day:
            special.append("음력생일")
    
    # 공휴일
    kr_holidays = holidays.KR()
    if today in kr_holidays:
        special.append("공휴일")
    
    # 연휴 전날
    tomorrow = today + datetime.timedelta(days=1)
    if (tomorrow in kr_holidays or tomorrow.weekday() >= 5) and today.weekday() < 5:
        if "공휴일" not in special:
            special.append("연휴전날")
    
    # 월초 (1-3일)
    if today.day <= 3:
        special.append("월초")
    
    # 월말 (28-31일)
    if today.day >= 28:
        special.append("월말")
    
    # 분기말 (3, 6, 9, 12월의 마지막 주)
    if today.month in [3, 6, 9, 12] and today.day >= 25:
        special.append("분기말")
    
    # 연초 (1월 1-7일)
    if today.month == 1 and today.day <= 7:
        special.append("연초")
    
    # 연말 (12월 20-31일)
    if today.month == 12 and today.day >= 20:
        special.append("연말")
    
    return special

def display_card(column, icon, title, value):
    with column:
        st.markdown(f'<div class="info-card"><div class="big-icon">{icon}</div><div class="card-title">{title}</div><div class="card-value">{value}</div></div>', unsafe_allow_html=True)

def generate_fortune(mbti, zodiac, animal, birth_date, weather_condition, today):
    """템플릿 기반 운세 생성"""
    
    # 시드 설정 (같은 날 + 같은 조합 = 같은 결과)
    time_slot = get_time_slot()
    seed = hash(f"{today.strftime('%Y-%m-%d')}-{mbti}-{zodiac}-{animal}-{time_slot}") % (2**32)
    random.seed(seed)
    
    # 요일 유형
    day_type, holiday_name = get_day_type(today)
    
    # 계절
    season = get_season(today)
    
    # 특수일
    special_days = get_special_days(birth_date, today)
    
    # 띠×별자리 궁합
    compat_key = (animal, zodiac)
    compatibility = TEMPLATES["compatibility"].get(compat_key, ("보통", "균형 잡힌 하루"))
    compat_level, compat_comment = compatibility
    
    # === 운세 조합 시작 ===
    
    # 1. 한줄운세 (MBTI 기본 + 띠 기운 + 궁합 보정)
    mbti_fortune = random.choice(TEMPLATES["mbti_fortune"][mbti])
    animal_energy = random.choice(TEMPLATES["animal_energy"][animal])
    
    if compat_level == "좋음":
        main_fortune = f"{mbti_fortune}, {animal_energy}"
    elif compat_level == "주의":
        main_fortune = f"{mbti_fortune} (단, 오늘은 신중하게)"
    else:
        main_fortune = mbti_fortune
    
    # 2. 오전 팁 (요일유형 + 별자리 오전운)
    morning_day = random.choice(TEMPLATES["day_type_morning"][day_type])
    morning_zodiac = random.choice(TEMPLATES["zodiac_morning"][zodiac])
    
    # 3. 오후 팁 (요일유형 + 별자리 오후운)
    afternoon_day = random.choice(TEMPLATES["day_type_afternoon"][day_type])
    afternoon_zodiac = random.choice(TEMPLATES["zodiac_afternoon"][zodiac])
    
    # 4. 퇴근 팁 (요일유형)
    evening_tip = random.choice(TEMPLATES["day_type_evening"][day_type])
    
    # 5. 주의보 (MBTI + 띠 + 궁합)
    mbti_warning = random.choice(TEMPLATES["mbti_warning"][mbti])
    animal_warning = random.choice(TEMPLATES["animal_warning"][animal])
    
    if compat_level == "주의":
        warning = f"{mbti_warning}. 특히 오늘은 {compat_comment}"
    else:
        warning = f"{mbti_warning}. 또한 {animal_warning}"
    
    # 6. 점심 팁 (날씨)
    lunch_tip = random.choice(TEMPLATES["weather_lunch"].get(weather_condition, TEMPLATES["weather_lunch"]["흐림"]))
    
    # 7. 행운템
    lucky_item = random.choice(TEMPLATES["lucky_items"])
    lucky_reason = TEMPLATES["lucky_item_reason"][animal].format(animal=animal)
    
    # 8. 계절 감성
    season_vibe = random.choice(TEMPLATES["season_vibe"][season])
    
    # 9. 오늘의 변수 (완전 랜덤)
    random.seed()  # 시드 리셋해서 진짜 랜덤
    random_var = random.choice(TEMPLATES["random_variable"])
    
    # 10. 시간대별 인트로
    time_intro = random.choice(TEMPLATES["time_intro"][time_slot])
    
    # 11. 특수일 메시지
    special_messages = []
    for sp in special_days:
        if sp in TEMPLATES["special_day"]:
            special_messages.append(random.choice(TEMPLATES["special_day"][sp]))
    
    # 12. 직장인 꿀팁
    office_tip = random.choice(TEMPLATES["office_tips"])
    
    # 13. 점심 메뉴 추천
    lunch_menu = random.choice(TEMPLATES["lunch_menu"])
    
    return {
        "main": main_fortune,
        "morning_day": morning_day,
        "morning_zodiac": morning_zodiac,
        "afternoon_day": afternoon_day,
        "afternoon_zodiac": afternoon_zodiac,
        "evening": evening_tip,
        "warning": warning,
        "lunch": lunch_tip,
        "lucky_item": lucky_item,
        "lucky_reason": lucky_reason,
        "season_vibe": season_vibe,
        "random_var": random_var,
        "time_intro": time_intro,
        "time_slot": time_slot,
        "day_type": day_type,
        "holiday_name": holiday_name,
        "compatibility": (compat_level, compat_comment),
        "special_days": special_days,
        "special_messages": special_messages,
        "office_tip": office_tip,
        "lunch_menu": lunch_menu,
    }

# --- 6. 메인 UI ---
subtitle_text = "데이터로 분석한 <span class='highlight'>오늘의 직장 생존 전략</span>"

# 타이틀 (날씨는 지역 선택 후 업데이트)
st.markdown(f'<div class="title-container"><span class="main-title">오늘의 눈치 레이더</span><div class="sub-title">{subtitle_text}</div><div class="engine-tag">Powered by Fortune Template Engine v2.0.0</div></div><hr style="border-top: 1px solid #333; margin-top: 5px; margin-bottom: 15px;">', unsafe_allow_html=True)

# 사용자 정보 입력
st.subheader("👤 내 정보")
c1, c2, c3, c4 = st.columns([2, 1, 1, 1])
mbti_list = ["ISTJ", "ISFJ", "INFJ", "INTJ", "ISTP", "ISFP", "INFP", "INTP", "ESTP", "ESFP", "ENFP", "ENTP", "ESTJ", "ESFJ", "ENFJ", "ENTJ"]

with c1: 
    user_birth = st.date_input("내 생년월일", value=datetime.date(1990, 1, 1), min_value=datetime.date(1920, 1, 1))
with c2: 
    user_gender = st.radio("내 성별", ["남성", "여성"], horizontal=True)
with c3: 
    user_mbti = st.selectbox("내 MBTI", mbti_list)
with c4:
    selected_district = st.selectbox("내 출근지역", list(BUSINESS_DISTRICTS.keys()), index=4)

district_info = BUSINESS_DISTRICTS[selected_district]
weather_icon, weather_text, weather_condition = get_weather(
    district_info["nx"], 
    district_info["ny"], 
    district_info["name"]
)

# 카드 데이터 계산
u_l = get_lunar_date(user_birth)
u_z = get_zodiac_sign(user_birth.day, user_birth.month)
u_a = get_korean_zodiac(user_birth)

c1, c2, c3, c4 = st.columns(4)
display_card(c1, ZODIAC_ICONS.get(u_z), "내 별자리", u_z)
display_card(c2, ANIMAL_ICONS.get(u_a), "내 띠", f"{u_a}띠")
display_card(c3, "🌕", "음력 생일", u_l)
display_card(c4, weather_icon, f"{district_info['name']} 날씨", weather_text)

st.write("")
st.markdown("---")

# --- 7. 분석 버튼 ---
if st.button("🚀 전략 분석 시작", type="primary", use_container_width=True):
    
    today = datetime.date.today()
    now = datetime.datetime.now()
    weekday_kr = ["월", "화", "수", "목", "금", "토", "일"][today.weekday()]
    
    # 운세 생성
    fortune = generate_fortune(
        mbti=user_mbti,
        zodiac=u_z,
        animal=u_a,
        birth_date=user_birth,
        weather_condition=weather_condition,
        today=today
    )
    
    # 특수일 배너 (있을 경우)
    if fortune["special_messages"]:
        for msg in fortune["special_messages"]:
            st.markdown(f"""
            <div class="special-banner">
                <div class="special-banner-title">{msg}</div>
            </div>
            """, unsafe_allow_html=True)
    
    # 결과 표시
    st.success(f"✅ {fortune['time_intro']}")
    
    # 궁합 표시
    compat_level, compat_comment = fortune["compatibility"]
    compat_color = {"좋음": "🟢", "보통": "🟡", "주의": "🔴"}[compat_level]
    
    # 메인 카드
    r1, r2, r3, r4 = st.columns(4)
    main_short = fortune["main"][:20] + "..." if len(fortune["main"]) > 20 else fortune["main"]
    morning_short = fortune["morning_day"][:18] + "..." if len(fortune["morning_day"]) > 20 else fortune["morning_day"]
    afternoon_short = fortune["afternoon_day"][:18] + "..." if len(fortune["afternoon_day"]) > 20 else fortune["afternoon_day"]
    display_card(r1, "🔮", "오늘 한줄", main_short)
    display_card(r2, "🌅", "오전", morning_short)
    display_card(r3, "🌆", "오후", afternoon_short)
    display_card(r4, "🍀", "행운템", fortune["lucky_item"])
    
    # 오늘의 변수 박스
    st.markdown(f"""
    <div class="variable-box">
        <div class="variable-title">🎲 오늘의 변수</div>
        <div class="variable-content">"{fortune['random_var']}"</div>
    </div>
    """, unsafe_allow_html=True)
    
    # 상세 분석
    st.markdown("---")
    st.markdown("### 📋 상세 전략 리포트")
    
    st.markdown(f"""
**🌤️ 오늘의 컨디션**: {fortune['season_vibe']}

**{compat_color} 띠x별자리 궁합**: {compat_level} - {compat_comment}

---

#### ⏰ 타임라인 전략

**🌅 오전 (출근~점심)**
> {fortune['morning_day']}

⭐ {u_z} 오전 기운: {fortune['morning_zodiac']}

**🍱 점심시간**
> {fortune['lunch']}

**🌆 오후 (점심 후~퇴근)**
> {fortune['afternoon_day']}

⭐ {u_z} 오후 기운: {fortune['afternoon_zodiac']}

**🌙 퇴근 후**
> {fortune['evening']}

---

#### 💡 오늘의 직장인 꿀팁

> {fortune['office_tip']}

---

#### 🍽️ 오늘의 점심 추천

> {fortune['lunch_menu']}

---

#### ⚠️ 오늘의 주의보

> {fortune['warning']}

---

#### 🍀 행운템: {fortune['lucky_item']}

{fortune['lucky_reason']} 아이템이야.  
책상 위에 두거나, 오늘 하루 가까이 두면 좋은 기운이 올 거야!
""")
    
    # 공유하기
    st.markdown("---")
    st.subheader("📋 친구에게 공유하기")
    
    share_text = f"""[오늘의 눈치 레이더] {today.strftime('%m/%d')} ({weekday_kr}) {fortune['day_type']}

🔮 한줄: {fortune['main'][:40]}
🌅 오전: {fortune['morning_day'][:40]}
🌆 오후: {fortune['afternoon_day'][:40]}
💡 꿀팁: {fortune['office_tip'][:40]}
🎲 변수: {fortune['random_var']}
🍀 행운템: {fortune['lucky_item']}

👉 나도 해보기: https://nunchi-radar.streamlit.app"""

    st.code(share_text, language="text")
    st.caption("👆 위 박스 오른쪽의 '복사(Copy)' 아이콘을 누르면 결과가 복사됩니다!")

